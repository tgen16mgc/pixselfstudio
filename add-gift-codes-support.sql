-- Migration: Add gift code support to discount_codes table
-- Run this in your Supabase SQL Editor

-- Step 1: Update discount_type constraint to include 'gift'
ALTER TABLE discount_codes 
DROP CONSTRAINT IF EXISTS discount_codes_discount_type_check;

ALTER TABLE discount_codes
ADD CONSTRAINT discount_codes_discount_type_check 
CHECK (discount_type IN ('percentage', 'fixed', 'gift'));

-- Step 2: Insert 80 gift codes for Loopy Charm
-- Valid from 31/10/2025 to 30/11/2025, 1-time use limit
INSERT INTO discount_codes (
  code, 
  discount_type, 
  discount_value, 
  apply_to, 
  min_purchase, 
  is_active,
  valid_from,
  valid_until,
  usage_limit
) VALUES
('YIW4', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('CQH6', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('2ASZ', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('45BA', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('XBC6', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('LDNZ', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('9ZP6', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('MTRC', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('PZ1H', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('QVZS', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('D7DS', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('4VVQ', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('EB5R', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('K277', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('0HUE', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('BFE4', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('ILK9', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('WNWR', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('7P5E', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('Y9G4', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('UPD8', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('CJ81', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('1IC4', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('YGVD', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('9BBW', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('NY82', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('RZES', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('V0XK', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('BIIS', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('4P92', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('B5VR', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('1HR6', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('IZTF', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('L1AA', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('59IV', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('P5WR', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('7L64', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('0TFM', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('X8HN', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('57P4', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('ILVV', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('WOLN', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('WMAW', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('LC82', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('C8WO', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('8NH1', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('3IT1', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('WF9I', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('EO5S', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('6CEB', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('U98N', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('QYQS', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('FCDV', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('6VWO', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('1W7J', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('YOOA', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('T21Y', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('UIGR', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('5TYF', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('JSCW', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('ANOE', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('BTC9', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('D0R8', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('KQ0L', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('CNW3', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('CWM8', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('QYW5', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('DWA9', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('BLZT', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('WW6R', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('18XI', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('HQA0', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('52FF', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('MRHV', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('DDWL', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('QQ8K', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('6MVX', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('Z5BN', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('Y0C5', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1),
('G822', 'gift', 0, 'total', 0, true, '2025-10-31 00:00:00', '2025-11-30 23:59:59', 1);

-- Verify the gift codes were added
SELECT code, discount_type, valid_from, valid_until, usage_limit, is_active 
FROM discount_codes 
WHERE discount_type = 'gift' 
ORDER BY code;
